<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>QUITUS Pay - Inscription</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&family=Space+Grotesk:wght@500;600;700&display=swap');
        
        * { font-family: 'DM Sans', sans-serif; -webkit-tap-highlight-color: transparent; }
        h1, h2, h3, .font-display { font-family: 'Space Grotesk', sans-serif; }
        
        :root {
            --quitus-dark: #1a2e0a;
            --quitus-primary: #2d4a0f;
            --quitus-secondary: #4a7c23;
            --quitus-light: #e8f5e9;
        }
        
        .bg-gradient-quitus { background: linear-gradient(135deg, var(--quitus-dark) 0%, var(--quitus-primary) 50%, var(--quitus-secondary) 100%); }
        
        .input-field {
            background: #f7fafc;
            border: 2px solid #e2e8f0;
            transition: all 0.3s;
        }
        .input-field:focus {
            border-color: var(--quitus-secondary);
            background: white;
            box-shadow: 0 0 0 3px rgba(74, 124, 35, 0.15);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--quitus-dark) 0%, var(--quitus-primary) 100%);
            transition: all 0.3s;
        }
        .btn-primary:hover:not(:disabled) { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(45, 74, 15, 0.4); }
        .btn-primary:disabled { opacity: 0.5; cursor: not-allowed; }
        
        .step-dot { transition: all 0.3s; }
        .step-dot.active { background: var(--quitus-primary); transform: scale(1.2); }
        .step-dot.completed { background: var(--quitus-secondary); }
        
        .otp-input {
            width: 48px; height: 56px; text-align: center; font-size: 24px; font-weight: 700;
            border: 2px solid #e5e7eb; border-radius: 12px; transition: all 0.2s;
        }
        .otp-input:focus { border-color: var(--quitus-primary); outline: none; }
        .otp-input.filled { border-color: var(--quitus-secondary); background: var(--quitus-light); }
        
        .slide-left { animation: slideLeft 0.3s ease-out; }
        @keyframes slideLeft { from { opacity: 0; transform: translateX(30px); } to { opacity: 1; transform: translateX(0); } }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <div class="max-w-md mx-auto min-h-screen bg-white shadow-2xl relative overflow-hidden">
        
        <!-- Header -->
        <div class="bg-gradient-quitus text-white p-5">
            <div class="flex items-center justify-between mb-4">
                <button onclick="goBack()" class="w-10 h-10 bg-white/20 rounded-full flex items-center justify-center">
                    <i class="fas fa-arrow-left"></i>
                </button>
                <h1 class="font-bold text-lg font-display" data-i18n="register">Inscription</h1>
                <div class="w-10"></div>
            </div>
            
            <!-- Step Indicator -->
            <div class="flex items-center justify-center space-x-3">
                <div id="dot1" class="step-dot active w-3 h-3 rounded-full bg-white/50"></div>
                <div class="w-8 h-0.5 bg-white/30"></div>
                <div id="dot2" class="step-dot w-3 h-3 rounded-full bg-white/50"></div>
                <div class="w-8 h-0.5 bg-white/30"></div>
                <div id="dot3" class="step-dot w-3 h-3 rounded-full bg-white/50"></div>
                <div class="w-8 h-0.5 bg-white/30"></div>
                <div id="dot4" class="step-dot w-3 h-3 rounded-full bg-white/50"></div>
            </div>
        </div>
        
        <!-- Step 1: Phone Number -->
        <div id="step1" class="p-6 slide-left">
            <h2 class="text-2xl font-bold text-gray-800 font-display mb-2" data-i18n="enterPhone">Entrez votre numéro</h2>
            <p class="text-gray-500 mb-6" data-i18n="enterPhoneDesc">Nous vous enverrons un code de vérification</p>
            
            <div class="mb-6">
                <label class="block text-sm font-medium text-gray-700 mb-2" data-i18n="phoneNumber">Numéro de téléphone</label>
                <div class="flex">
                    <div class="flex items-center px-4 bg-gray-100 border-2 border-r-0 border-gray-200 rounded-l-xl">
                        <img src="https://flagcdn.com/w20/cm.png" class="w-5 h-4 mr-2" alt="CM">
                        <span class="text-gray-600 font-medium">+237</span>
                    </div>
                    <input type="tel" id="phone" placeholder="6XX XXX XXX" 
                        class="input-field flex-1 px-4 py-4 rounded-r-xl focus:outline-none text-lg" maxlength="9" oninput="validateStep1()">
                </div>
            </div>
            
            <button id="step1Btn" onclick="goToStep2()" disabled class="btn-primary w-full text-white py-4 rounded-xl font-semibold text-lg">
                <span data-i18n="continue">Continuer</span>
            </button>
        </div>
        
        <!-- Step 2: OTP Verification -->
        <div id="step2" class="hidden p-6 slide-left">
            <h2 class="text-2xl font-bold text-gray-800 font-display mb-2" data-i18n="verifyPhone">Vérification</h2>
            <p class="text-gray-500 mb-2" data-i18n="otpSent">Un code a été envoyé au</p>
            <p class="font-bold text-gray-800 mb-6" id="displayPhone">+237 6XX XXX XXX</p>
            
            <div class="flex justify-center space-x-2 mb-6">
                <input type="text" maxlength="1" class="otp-input" oninput="handleOtp(this, 0)" onkeydown="handleOtpKey(event, 0)">
                <input type="text" maxlength="1" class="otp-input" oninput="handleOtp(this, 1)" onkeydown="handleOtpKey(event, 1)">
                <input type="text" maxlength="1" class="otp-input" oninput="handleOtp(this, 2)" onkeydown="handleOtpKey(event, 2)">
                <input type="text" maxlength="1" class="otp-input" oninput="handleOtp(this, 3)" onkeydown="handleOtpKey(event, 3)">
                <input type="text" maxlength="1" class="otp-input" oninput="handleOtp(this, 4)" onkeydown="handleOtpKey(event, 4)">
                <input type="text" maxlength="1" class="otp-input" oninput="handleOtp(this, 5)" onkeydown="handleOtpKey(event, 5)">
            </div>
            
            <div class="text-center mb-6">
                <p class="text-gray-500 text-sm" data-i18n="noCode">Vous n'avez pas reçu le code?</p>
                <button id="resendBtn" onclick="resendOtp()" class="text-green-700 font-semibold text-sm mt-1" disabled>
                    <span data-i18n="resendIn">Renvoyer dans</span> <span id="countdown">60</span>s
                </button>
            </div>
            
            <button id="step2Btn" onclick="goToStep3()" disabled class="btn-primary w-full text-white py-4 rounded-xl font-semibold text-lg">
                <span data-i18n="verify">Vérifier</span>
            </button>
        </div>
        
        <!-- Step 3: Personal Info -->
        <div id="step3" class="hidden p-6 slide-left">
            <h2 class="text-2xl font-bold text-gray-800 font-display mb-2" data-i18n="personalInfo">Informations personnelles</h2>
            <p class="text-gray-500 mb-6" data-i18n="personalInfoDesc">Dites-nous en plus sur vous</p>
            
            <div class="space-y-4 mb-6">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2" data-i18n="firstName">Prénom</label>
                    <input type="text" id="firstName" placeholder="Jean" class="input-field w-full px-4 py-3 rounded-xl focus:outline-none" oninput="validateStep3()">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2" data-i18n="lastName">Nom</label>
                    <input type="text" id="lastName" placeholder="Dupont" class="input-field w-full px-4 py-3 rounded-xl focus:outline-none" oninput="validateStep3()">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2" data-i18n="email">Email (optionnel)</label>
                    <input type="email" id="email" placeholder="jean@exemple.com" class="input-field w-full px-4 py-3 rounded-xl focus:outline-none">
                </div>
            </div>
            
            <button id="step3Btn" onclick="goToStep4()" disabled class="btn-primary w-full text-white py-4 rounded-xl font-semibold text-lg">
                <span data-i18n="continue">Continuer</span>
            </button>
        </div>
        
        <!-- Step 4: Create PIN -->
        <div id="step4" class="hidden p-6 slide-left">
            <h2 class="text-2xl font-bold text-gray-800 font-display mb-2" data-i18n="createPin">Créez votre PIN</h2>
            <p class="text-gray-500 mb-6" data-i18n="createPinDesc">Ce code sécurisera vos transactions</p>
            
            <div class="mb-6">
                <label class="block text-sm font-medium text-gray-700 mb-2" data-i18n="pin">Code PIN (6 chiffres)</label>
                <input type="password" id="pin" placeholder="••••••" 
                    class="input-field w-full px-4 py-4 rounded-xl focus:outline-none text-2xl text-center tracking-widest" maxlength="6" oninput="validateStep4()">
            </div>
            
            <div class="mb-6">
                <label class="block text-sm font-medium text-gray-700 mb-2" data-i18n="confirmPin">Confirmez le PIN</label>
                <input type="password" id="confirmPin" placeholder="••••••" 
                    class="input-field w-full px-4 py-4 rounded-xl focus:outline-none text-2xl text-center tracking-widest" maxlength="6" oninput="validateStep4()">
            </div>
            
            <p id="pinError" class="text-red-500 text-sm mb-4 hidden" data-i18n="pinMismatch">Les codes PIN ne correspondent pas</p>
            
            <!-- Terms -->
            <div class="flex items-start space-x-3 mb-6">
                <input type="checkbox" id="terms" class="mt-1 w-5 h-5 rounded border-gray-300 text-green-600 focus:ring-green-500" onchange="validateStep4()">
                <label for="terms" class="text-sm text-gray-600">
                    <span data-i18n="acceptTerms">J'accepte les</span>
                    <a href="#" class="text-green-700 font-medium" data-i18n="termsLink">Conditions d'utilisation</a>
                    <span data-i18n="and">et la</span>
                    <a href="#" class="text-green-700 font-medium" data-i18n="privacyLink">Politique de confidentialité</a>
                </label>
            </div>
            
            <button id="step4Btn" onclick="completeRegistration()" disabled class="btn-primary w-full text-white py-4 rounded-xl font-semibold text-lg">
                <span data-i18n="createAccount">Créer mon compte</span>
            </button>
        </div>
        
        <!-- Success -->
        <div id="successScreen" class="hidden p-6 text-center slide-left">
            <div class="py-10">
                <div class="w-24 h-24 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-6">
                    <i class="fas fa-check text-green-600 text-4xl"></i>
                </div>
                <h2 class="text-2xl font-bold text-gray-800 font-display mb-2" data-i18n="welcome">Bienvenue!</h2>
                <p class="text-gray-500 mb-8" data-i18n="accountCreated">Votre compte a été créé avec succès</p>
                
                <button onclick="goToHome()" class="btn-primary w-full text-white py-4 rounded-xl font-semibold text-lg">
                    <span data-i18n="startUsing">Commencer à utiliser QUITUS Pay</span>
                </button>
            </div>
        </div>
    </div>
    
    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="fixed inset-0 bg-black/50 hidden items-center justify-center z-50">
        <div class="bg-white rounded-2xl p-8 text-center">
            <div class="w-16 h-16 border-4 border-green-600 border-t-transparent rounded-full animate-spin mx-auto mb-4"></div>
            <p class="text-gray-700 font-medium" data-i18n="processing">Traitement...</p>
        </div>
    </div>

    <script>
        // ==================== i18n ====================
        const translations = {
            fr: {
                register: "Inscription",
                enterPhone: "Entrez votre numéro",
                enterPhoneDesc: "Nous vous enverrons un code de vérification",
                phoneNumber: "Numéro de téléphone",
                continue: "Continuer",
                verifyPhone: "Vérification",
                otpSent: "Un code a été envoyé au",
                noCode: "Vous n'avez pas reçu le code?",
                resendIn: "Renvoyer dans",
                resend: "Renvoyer le code",
                verify: "Vérifier",
                personalInfo: "Informations personnelles",
                personalInfoDesc: "Dites-nous en plus sur vous",
                firstName: "Prénom",
                lastName: "Nom",
                email: "Email (optionnel)",
                createPin: "Créez votre PIN",
                createPinDesc: "Ce code sécurisera vos transactions",
                pin: "Code PIN (6 chiffres)",
                confirmPin: "Confirmez le PIN",
                pinMismatch: "Les codes PIN ne correspondent pas",
                acceptTerms: "J'accepte les",
                termsLink: "Conditions d'utilisation",
                and: "et la",
                privacyLink: "Politique de confidentialité",
                createAccount: "Créer mon compte",
                welcome: "Bienvenue!",
                accountCreated: "Votre compte a été créé avec succès",
                startUsing: "Commencer à utiliser QUITUS Pay",
                processing: "Traitement..."
            },
            en: {
                register: "Register",
                enterPhone: "Enter your number",
                enterPhoneDesc: "We'll send you a verification code",
                phoneNumber: "Phone number",
                continue: "Continue",
                verifyPhone: "Verification",
                otpSent: "A code was sent to",
                noCode: "Didn't receive the code?",
                resendIn: "Resend in",
                resend: "Resend code",
                verify: "Verify",
                personalInfo: "Personal Information",
                personalInfoDesc: "Tell us more about yourself",
                firstName: "First name",
                lastName: "Last name",
                email: "Email (optional)",
                createPin: "Create your PIN",
                createPinDesc: "This code will secure your transactions",
                pin: "PIN code (6 digits)",
                confirmPin: "Confirm PIN",
                pinMismatch: "PIN codes don't match",
                acceptTerms: "I accept the",
                termsLink: "Terms of Service",
                and: "and the",
                privacyLink: "Privacy Policy",
                createAccount: "Create my account",
                welcome: "Welcome!",
                accountCreated: "Your account has been created successfully",
                startUsing: "Start using QUITUS Pay",
                processing: "Processing..."
            },
            es: {
                register: "Registro",
                enterPhone: "Ingresa tu número",
                enterPhoneDesc: "Te enviaremos un código de verificación",
                phoneNumber: "Número de teléfono",
                continue: "Continuar",
                verifyPhone: "Verificación",
                otpSent: "Se envió un código al",
                noCode: "¿No recibiste el código?",
                resendIn: "Reenviar en",
                resend: "Reenviar código",
                verify: "Verificar",
                personalInfo: "Información Personal",
                personalInfoDesc: "Cuéntanos más sobre ti",
                firstName: "Nombre",
                lastName: "Apellido",
                email: "Email (opcional)",
                createPin: "Crea tu PIN",
                createPinDesc: "Este código asegurará tus transacciones",
                pin: "Código PIN (6 dígitos)",
                confirmPin: "Confirmar PIN",
                pinMismatch: "Los códigos PIN no coinciden",
                acceptTerms: "Acepto los",
                termsLink: "Términos de Servicio",
                and: "y la",
                privacyLink: "Política de Privacidad",
                createAccount: "Crear mi cuenta",
                welcome: "¡Bienvenido!",
                accountCreated: "Tu cuenta ha sido creada exitosamente",
                startUsing: "Comenzar a usar QUITUS Pay",
                processing: "Procesando..."
            }
        };
        
        let currentLanguage = localStorage.getItem('quitusLang') || 'fr';
        let registrationData = { phone: '', firstName: '', lastName: '', email: '', pin: '' };
        let countdownInterval;
        
        function applyTranslations() {
            const t = translations[currentLanguage];
            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                if (t[key]) el.textContent = t[key];
            });
        }
        
        // ==================== Step Navigation ====================
        function updateDots(step) {
            for (let i = 1; i <= 4; i++) {
                const dot = document.getElementById('dot' + i);
                dot.classList.remove('active', 'completed');
                if (i < step) dot.classList.add('completed');
                if (i === step) dot.classList.add('active');
            }
        }
        
        function validateStep1() {
            const phone = document.getElementById('phone').value;
            document.getElementById('step1Btn').disabled = phone.length !== 9;
        }
        
        function goToStep2() {
            registrationData.phone = document.getElementById('phone').value;
            document.getElementById('displayPhone').textContent = '+237 ' + formatPhone(registrationData.phone);
            document.getElementById('step1').classList.add('hidden');
            document.getElementById('step2').classList.remove('hidden');
            updateDots(2);
            startCountdown();
        }
        
        function goToStep3() {
            document.getElementById('step2').classList.add('hidden');
            document.getElementById('step3').classList.remove('hidden');
            updateDots(3);
        }
        
        function validateStep3() {
            const firstName = document.getElementById('firstName').value;
            const lastName = document.getElementById('lastName').value;
            document.getElementById('step3Btn').disabled = !firstName || !lastName;
        }
        
        function goToStep4() {
            registrationData.firstName = document.getElementById('firstName').value;
            registrationData.lastName = document.getElementById('lastName').value;
            registrationData.email = document.getElementById('email').value;
            document.getElementById('step3').classList.add('hidden');
            document.getElementById('step4').classList.remove('hidden');
            updateDots(4);
        }
        
        function validateStep4() {
            const pin = document.getElementById('pin').value;
            const confirmPin = document.getElementById('confirmPin').value;
            const terms = document.getElementById('terms').checked;
            const pinError = document.getElementById('pinError');
            
            if (pin.length === 6 && confirmPin.length === 6 && pin !== confirmPin) {
                pinError.classList.remove('hidden');
            } else {
                pinError.classList.add('hidden');
            }
            
            document.getElementById('step4Btn').disabled = !(pin.length === 6 && pin === confirmPin && terms);
        }
        
        function completeRegistration() {
            registrationData.pin = document.getElementById('pin').value;
            
            document.getElementById('loadingOverlay').classList.remove('hidden');
            document.getElementById('loadingOverlay').classList.add('flex');
            
            setTimeout(() => {
                document.getElementById('loadingOverlay').classList.add('hidden');
                document.getElementById('step4').classList.add('hidden');
                document.getElementById('successScreen').classList.remove('hidden');
            }, 2000);
        }
        
        // ==================== OTP Handling ====================
        function handleOtp(input, index) {
            input.value = input.value.replace(/\D/g, '');
            if (input.value.length === 1) {
                input.classList.add('filled');
                if (index < 5) document.querySelectorAll('.otp-input')[index + 1].focus();
            } else {
                input.classList.remove('filled');
            }
            validateOtp();
        }
        
        function handleOtpKey(e, index) {
            if (e.key === 'Backspace' && !e.target.value && index > 0) {
                document.querySelectorAll('.otp-input')[index - 1].focus();
            }
        }
        
        function validateOtp() {
            let otp = '';
            document.querySelectorAll('.otp-input').forEach(input => otp += input.value);
            document.getElementById('step2Btn').disabled = otp.length !== 6;
        }
        
        function startCountdown() {
            let seconds = 60;
            const btn = document.getElementById('resendBtn');
            const countdown = document.getElementById('countdown');
            
            clearInterval(countdownInterval);
            countdownInterval = setInterval(() => {
                seconds--;
                countdown.textContent = seconds;
                if (seconds <= 0) {
                    clearInterval(countdownInterval);
                    btn.disabled = false;
                    btn.innerHTML = '<span data-i18n="resend">' + translations[currentLanguage].resend + '</span>';
                }
            }, 1000);
        }
        
        function resendOtp() {
            startCountdown();
            document.getElementById('resendBtn').disabled = true;
            document.getElementById('resendBtn').innerHTML = '<span data-i18n="resendIn">' + translations[currentLanguage].resendIn + '</span> <span id="countdown">60</span>s';
        }
        
        // ==================== Utility ====================
        function formatPhone(phone) {
            return phone.replace(/(\d{3})(\d{3})(\d{3})/, '$1 $2 $3');
        }
        
        function goBack() {
            if (!document.getElementById('step1').classList.contains('hidden')) {
                window.location.href = 'quitus_pay_login_v2.html';
            } else if (!document.getElementById('step2').classList.contains('hidden')) {
                document.getElementById('step2').classList.add('hidden');
                document.getElementById('step1').classList.remove('hidden');
                updateDots(1);
            } else if (!document.getElementById('step3').classList.contains('hidden')) {
                document.getElementById('step3').classList.add('hidden');
                document.getElementById('step2').classList.remove('hidden');
                updateDots(2);
            } else if (!document.getElementById('step4').classList.contains('hidden')) {
                document.getElementById('step4').classList.add('hidden');
                document.getElementById('step3').classList.remove('hidden');
                updateDots(3);
            }
        }
        
        function goToHome() {
            window.location.href = 'quitus_pay_home_v2.html';
        }
        
        document.getElementById('phone').addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            if (value.length > 9) value = value.slice(0, 9);
            e.target.value = value;
        });
        
        document.addEventListener('DOMContentLoaded', applyTranslations);
    </script>
</body>
</html>
